doctype html
html
        head
                title 텔레봇
                meta(charset='utf-8')
                meta(name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui")
                link(rel='stylesheet' href='../css/default.css')
                link(rel='stylesheet' href='../css/chat.css')
                link(rel="stylesheet" href="../css/vuetify.min.css")
                link(rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@3.x/css/materialdesignicons.min.css")
                script(src="https://cdn.jsdelivr.net/npm/vue")
                script(src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js")
                script(src="https://unpkg.com/axios/dist/axios.min.js")
                //- script(src="https://code.jquery.com/jquery-3.4.1.js")

        body
                #app
                        //- v-app(v-if="!show")
                        //-         v-layout(justify-center align-center)
                        //-                 v-col(cols='12')
                        //-                         v-row.intro-btn(justify="center" align-center="center")
                        //-                                 v-btn.right-btn(v-on:click="show = !show;flag = 1" color='info' large) 학칙
                        //-                                 v-btn(v-on:click="show = !show;flag=2" color='info' large) 대학생활
                        //- transition(name="fade")
                        v-app
                                v-app-bar(dense clipped-left)(style="background-color:#fec995!important;")
                                        v-app-bar-nav-icon(style="background-color:#fec995!important;")
                                        v-toolbar-title 인하공업전문대학 텔레봇
                                v-container.chat-area(blue lighten-2)
                                        v-container(v-for="chat in chatlist" grid-list-lg fluid)
                                                v-layout.chat-layout(v-if="chat.flag===1" align-start justify-start row fill-height)
                                                        v-flex.chat-avatar
                                                                v-avatar(color="indigo" size="36")
                                                                        img(src="./img/logo.jpg" alt="avatar")
                                                                span.chat-name 텔레봇
                                                                v-flex.chat-box(v-if="chat.panel===false")
                                                                        v-card
                                                                                span {{chat.text}}
                                                                v-expansion-panels.chat-panels(v-if="chat.panel===true")
                                                                        v-expansion-panel.chat-panel(v-for="bot in chat.botlist")
                                                                                //v-expansion-panel.chat-panel(v-if="bot.location != ''")
                                                                                v-expansion-panel-header {{bot.group_title}}{{bot.location}} {{bot.position}} {{bot.name}} {{bot.job}}
                                                                                v-expansion-panel-content.content(v-html="bot.content")

                                                                                        

                                                v-layout.chat-layout(v-if="chat.flag===2" align-start justify-end row fill-height)
                                                        v-flex.chat-box
                                                                v-card(color="amber lighten-2")
                                                                        span {{chat.text}}
                                                        v-flex.chat-avatar
                                                                v-avatar(color="#d3d3d3" size="36")
                                                                        img(src="./img/user.png" alt="avatar")
                                v-footer(blue lighten-2)
                                        v-row.input-area(no-gutters)
                                                v-col
                                                        v-text-field(label='입력하세요' single-line filled v-model="userText" v-on:keyup.enter="userInput")
                                                                template(v-slot:append)
                                                                        v-btn.input-btn(depressed color="primary" v-on:click="userInput") 전송
        script.
                Vue.config.devtools = true 
                app=new Vue({
                        el:'#app',
                        vuetify:new Vuetify({
                                theme:{
                                        dark:false
                                }
                        }),
                        data:{
                                show:false,
                                chatlist:[{flag:1,text:"안녕하세요. 인하공전 텔레봇입니다. 교직원, 부서의 전화번호를 알려드립니다.",panel:false}],
                                userText:"",
                                flag:"",
                        },
                        updated:function(){
                                this.autoScroll()
                        },
                        methods:{
                                autoScroll:function(){
                                        const el=this.$el.getElementsByClassName('input-area')[0]
                                        if(el){
                                                el.scrollIntoView()
                                        }
                                },
                                getData:function(){
                                        var self=this
                                        userText=this.userText
                                        this.userText=""
                                        
                                        axios.post("/chat",{userText:userText,flag:2}).then((result)=>{  
                                                if(!result.data.dataNone){
                                                        data=result.data.data
                                                        dataLen=result.data.data.length
                                                        if(dataLen<1){
                                                                extract={
                                                                        flag:1,
                                                                        panel:false,
                                                                        text:'검색결과가 없습니다'
                                                                }
                                                                this.chatlist.push(extract)
                                                                return
                                                        }
                                                        if(data == "FAX"){
                                                                extract={
                                                                        flag:1,
                                                                        panel:false,
                                                                        text:'정확한 부서명과 단어 "FAX(팩스)"를 입력해주세요.' + " 예) OO팀 FAX"

                                                                }
                                                                this.chatlist.push(extract)
                                                                return
                                                        }
                                                        if(data == "민원안내"){
                                                                extract={
                                                                        flag:1,
                                                                        panel:false,
                                                                        text:'정확한 부서명과 단어 "민원안내"를 입력해주세요.' + " 예) OO부서 민원안내"

                                                                }
                                                                this.chatlist.push(extract)
                                                                return
                                                        }
                                                        panellist=[]
                                                        //- for(key in data){
                                                        //-         //- list={indexNo:data[key].indexNo,
                                                        //-         //-         group_no:data[key].group_no,
                                                        //-         //-         group_title:data[key].group_title,
                                                        //-         //-         content:data[key].content.replace(/(?:\r\n|\r|\n)/g, '<br />')}
                                                        //-         panellist.push(list)
                                                        //- }
                                                        for(var i=0;i<dataLen;i=i+1){
                                                                var loc = ""
                                                                var job = ""
                                                                var content = ""
                                                                if(data[i].num_location != ""){
                                                                        loc = "("+data[i].num_location+")"
                                                                }
                                                                if(data[i].num_job != ""){
                                                                        job = " - " + data[i].num_job
                                                                }
                                                                if(data[i].num_number.length > 5){
                                                                        content = "☎ 032-" + data[i].num_number + " <a class='calling' href='tel:010-5896-2240'> 전화걸기</a>"
                                                                }else if(data[i].num_number.length <= 4){
                                                                        content = "☎ 032-870-" + data[i].num_number + " <a class='calling' href='tel:010-5896-2240'> 전화걸기</a>"
                                                                }

                                                                list={
                                                                        indexNo:data[i].Data_idx,
                                                                        group_title:data[i].num_group,
                                                                        name:data[i].num_name,
                                                                        job:job,
                                                                        location:loc,
                                                                        position:data[i].num_position,
                                                                        content:content,
                                                                        sub_content:data[i].num_sub_num
                                                                }
                                                                panellist.push(list)
                                                        }
                                                        extract={
                                                                flag:1,
                                                                panel:true,
                                                                botlist:panellist
                                                        }
                                                        this.chatlist.push(extract)
                                                }else{
                                                        extract={
                                                                flag:1,
                                                                panel:false,
                                                                text:'검색결과가 없습니다'
                                                        }
                                                        this.chatlist.push(extract)

                                                }
                                        }).catch((e)=>{
                                                console.log(e)
                                                alert(e)
                                                extract={
                                                        flag:1,
                                                        panel:false,
                                                        text:'오류발생'
                                                }
                                                this.chatlist.push(extract)
                                        })
                                },
                                userInput:function(){
                                        user={flag:2,text:this.userText,panel:false}
                                        this.chatlist.push(user)
                                        this.getData()
                                }
                        },
                })
